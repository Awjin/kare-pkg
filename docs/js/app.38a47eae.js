(function(t){function e(e){for(var n,a,s=e[0],c=e[1],u=e[2],l=0,p=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&p.push(i[a][0]),i[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);d&&d(e);while(p.length)p.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,s=1;s<r.length;s++){var c=r[s];0!==i[c]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=r[0]))}return t}var n={},i={app:0},o=[];function a(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=n,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/kare-pkg/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var d=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("cd49")},"1d97":function(t,e,r){},"1f8b":function(t,e,r){"use strict";var n=r("7797"),i=r.n(n);i.a},"5c0b":function(t,e,r){"use strict";var n=r("9c0c"),i=r.n(n);i.a},"66f7":function(t,e,r){"use strict";var n=r("b336"),i=r.n(n);i.a},"6fc8":function(t,e,r){"use strict";var n=r("abaf"),i=r.n(n);i.a},7707:function(t,e,r){"use strict";var n=r("7bd8"),i=r.n(n);i.a},7797:function(t,e,r){},"7bd8":function(t,e,r){},"9c0c":function(t,e,r){},abaf:function(t,e,r){},b336:function(t,e,r){},cd49:function(t,e,r){"use strict";r.r(e);var n=r("2b0e"),i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("transition",{attrs:{name:"fade",mode:"out-in"}},[r("router-view")],1)},o=[],a=(r("5c0b"),r("2877")),s={},c=Object(a["a"])(s,i,o,!1,null,null,null),u=c.exports,d=r("8c4f"),l=r("2f62"),p=r("9ab4"),f=32,h=20,g=function(){function t(){}return t}(),v=function(){function t(t,e,r){void 0===t&&(t={}),void 0===e&&(e=[]),void 0===r&&(r=-1),this.pixelMap=t,this.strokes=e,this.currStroke=r,this.id=Math.random(),this.preview="";var n=f*h;for(var i in this.canvas=document.createElement("canvas"),this.canvas.height=n,this.canvas.width=n,this.context=this.canvas.getContext("2d"),this.context.fillStyle="white",this.context.fillRect(0,0,n,n),t)t[i]&&this.updateCanvas(i);this.generatePreview()}return Object.defineProperty(t.prototype,"canUndo",{get:function(){return this.currStroke>=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRedo",{get:function(){return this.currStroke<this.strokes.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exportFormat",{get:function(){return{pixelMap:this.pixelMap,strokes:this.strokes,currStroke:this.currStroke}},enumerable:!0,configurable:!0}),t.prototype.flip=function(t,e){this.updatePixelMap(t),this.updateHistory(t,e),this.updateCanvas(t),this.generatePreview()},t.prototype.clear=function(){var t=new g;for(var e in this.pixelMap)this.pixelMap[e]&&(this.updatePixelMap(e),this.updateHistory(e,t),this.updateCanvas(e));this.generatePreview()},t.prototype.undo=function(){var t,e;if(this.canUndo){try{for(var r=Object(p["c"])(this.strokes[this.currStroke]),n=r.next();!n.done;n=r.next()){var i=n.value;this.updatePixelMap(i),this.updateCanvas(i)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this.currStroke--,this.generatePreview()}},t.prototype.redo=function(){var t,e;if(this.canRedo){this.currStroke++;try{for(var r=Object(p["c"])(this.strokes[this.currStroke]),n=r.next();!n.done;n=r.next()){var i=n.value;this.updatePixelMap(i),this.updateCanvas(i)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this.generatePreview()}},t.prototype.updatePixelMap=function(t){this.pixelMap[t]=!this.pixelMap[t]},t.prototype.updateHistory=function(t,e){e===this.strokeStart?this.strokes[this.currStroke].push(t):(this.currStroke++,this.strokeStart=e,this.strokes[this.currStroke]=[t]),this.currStroke<this.strokes.length-1&&(this.strokes=this.strokes.slice(0,this.currStroke+1))},t.prototype.updateCanvas=function(t){var e=parseInt(t),r=e%f,n=Math.floor(e/f);this.context.fillStyle=this.pixelMap[t]?"black":"white",this.context.fillRect(r*h,n*h,h,h)},t.prototype.generatePreview=function(){this.preview=this.canvas.toDataURL("image/png")},t}(),w={205:!0,206:!0,207:!0,208:!0,209:!0,210:!0,237:!0,238:!0,239:!0,240:!0,241:!0,242:!0,269:!0,270:!0,271:!0,272:!0,273:!0,274:!0,301:!0,302:!0,303:!0,304:!0,305:!0,306:!0,589:!0,590:!0,591:!0,592:!0,593:!0,594:!0,621:!0,622:!0,623:!0,624:!0,625:!0,626:!0,653:!0,654:!0,655:!0,656:!0,657:!0,658:!0,685:!0,686:!0,687:!0,688:!0,689:!0,690:!0,332:!0,363:!0,395:!0,427:!0,459:!0,491:!0,523:!0,556:!0,339:!0,372:!0,404:!0,436:!0,468:!0,500:!0,532:!0,563:!0,437:!0,469:!0,462:!0,463:!0,464:!0,368:!0,400:!0,432:!0};function b(t){localStorage.setItem("kare-pkg",JSON.stringify(t))}n["a"].use(l["a"]);var m=new l["a"].Store({state:{drawings:[new v(w)]},getters:{exportFile:function(t){return function(){var e=JSON.stringify(t.drawings.map((function(t){return t.exportFormat})));return"data:application/json;charset=utf-8,"+encodeURIComponent(e)}}},mutations:{flip:function(t,e){var r=e.drawingIdx,n=e.pixelIdx,i=e.event;t.drawings[r].flip(n,i),b(t)},undo:function(t,e){var r=e.drawingIdx;t.drawings[r].undo(),b(t)},redo:function(t,e){var r=e.drawingIdx;t.drawings[r].redo(),b(t)},clear:function(t,e){var r=e.drawingIdx;t.drawings[r].clear(),b(t)},copy:function(t,e){var r=e.drawingIdx,n=t.drawings[r],i=new v(Object.assign({},n.pixelMap),n.strokes.slice(0,n.strokes.length),n.currStroke);t.drawings.unshift(i),b(t)},new:function(t){t.drawings.unshift(new v),b(t)},remove:function(t,e){var r=e.drawingIdx;t.drawings.splice(r,1),b(t)},load:function(t){if(localStorage["kare-pkg"]){var e=JSON.parse(localStorage["kare-pkg"]).drawings;t.drawings=e.map((function(t){return new v(t.pixelMap,t.strokes,t.currStroke)}))}},import:function(t,e){for(var r=e.drawings,n=r.length-1;n>=0;n--)try{var i=new v(r[n].pixelMap,r[n].strokes,r[n].currStroke);t.drawings.unshift(i)}catch(o){}b(t)},removeAll:function(t){t.drawings.splice(0,t.drawings.length),b(t)},setDrawings:function(t,e){var r=e.drawings;t.drawings=r,b(t)}}}),y=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("home-header"),r("main",[r("draggable",t._b({model:{value:t.drawings,callback:function(e){t.drawings=e},expression:"drawings"}},"draggable",t.dragOptions,!1),[r("transition-group",t._l(t.drawings,(function(e,n){return r("router-link",{key:e.id,staticClass:"thumbnail",attrs:{to:t.getRoute(n)}},[r("preview",{attrs:{drawingIdx:n}})],1)})),1)],1)],1)],1)},x=[],k=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("site-header",{scopedSlots:t._u([{key:"left",fn:function(){return[r("a",{on:{click:function(e){return e.preventDefault(),t.newDrawing(e)}}},[t._v("+ CREATE")])]},proxy:!0},{key:"right",fn:function(){return[r("a",{attrs:{href:t.exportFile,disabled:!t.isExportable,download:"kare.pkg backup "+(new Date).toLocaleString()+".json"}},[t._v("export")]),r("form",[r("label",{attrs:{for:"file"}},[r("a",[t._v("import")])]),r("input",{attrs:{accept:".json",hidden:"",id:"file",multiple:"false",type:"file"},on:{change:t.importFile}})]),r("a",{on:{click:t.removeAll}},[t._v("delete all")])]},proxy:!0}])})},O=[],S=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("header",[r("div",{staticClass:"left"},[t._t("left")],2),r("div",{staticClass:"right"},[t._t("right")],2)])},j=[],I=r("60a3"),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(p["b"])(e,t),e=Object(p["a"])([Object(I["a"])({name:"SiteHeader"})],e),e}(I["c"]),P=_,E=P,$=(r("7707"),Object(a["a"])(E,S,j,!1,null,"47cf3f35",null)),M=$.exports,C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(p["b"])(e,t),Object.defineProperty(e.prototype,"isExportable",{get:function(){return this.$store.state.drawings.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exportFile",{get:function(){return this.$store.getters.exportFile()},enumerable:!0,configurable:!0}),e.prototype.newDrawing=function(){this.$store.commit("new"),this.$router.push("/edit/0")},e.prototype.importFile=function(t){var e=this,r=t.target;if(r&&r.files&&0!==r.files.length){var n=new FileReader;n.onload=function(t){var r=t.target.result;r&&e.$store.commit("import",{drawings:JSON.parse(r.toString())})},n.readAsText(r.files[0]),r.parentElement.reset()}},e.prototype.removeAll=function(){window.confirm("This cannot be undone. Are you sure?")&&this.$store.commit("removeAll")},e=Object(p["a"])([Object(I["a"])({name:"HomeHeader",components:{SiteHeader:M}})],e),e}(I["c"]),D=C,H=D,R=Object(a["a"])(H,k,O,!1,null,null,null),T=R.exports,L=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("img",{staticClass:"preview",attrs:{src:t.preview}})},F=[],A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(p["b"])(e,t),Object.defineProperty(e.prototype,"preview",{get:function(){return this.$store.state.drawings[this.drawingIdx].preview},enumerable:!0,configurable:!0}),Object(p["a"])([Object(I["b"])()],e.prototype,"drawingIdx",void 0),e=Object(p["a"])([Object(I["a"])({name:"Preview"})],e),e}(I["c"]),U=A,J=U,z=(r("66f7"),Object(a["a"])(J,L,F,!1,null,"8a0935ce",null)),K=z.exports,N=r("310e"),B=r.n(N),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(p["b"])(e,t),Object.defineProperty(e.prototype,"drawings",{get:function(){return this.$store.state.drawings},set:function(t){this.$store.commit("setDrawings",{drawings:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragOptions",{get:function(){return{direction:"horizontal",delay:500,delayOnTouchOnly:!0,touchStartThreshold:5,fallbackTolerance:5,emptyInsertThreshold:0,animation:200,easing:"cubic-bezier(0.4, 0, 0.2, 1)",chosenClass:"drag-chosen",ghostClass:"drag-ghost"}},enumerable:!0,configurable:!0}),e.prototype.getRoute=function(t){return"/edit/"+t},e=Object(p["a"])([Object(I["a"])({name:"Home",components:{HomeHeader:T,Preview:K,Draggable:B.a}})],e),e}(I["c"]),Y=X,q=Y,G=(r("e4aa"),Object(a["a"])(q,y,x,!1,null,"84b9d188",null)),Q=G.exports,V=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("EditorHeader",{attrs:{drawingIdx:t.drawingIdx}}),r("main",[r("preview",{staticClass:"edit__preview",attrs:{drawingIdx:t.drawingIdx}}),r("editor",{staticClass:"edit__editor",attrs:{drawingIdx:t.drawingIdx}})],1)],1)},W=[],Z=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("site-header",{scopedSlots:t._u([{key:"left",fn:function(){return[r("router-link",{attrs:{to:"/"}},[t._v("< BACK")])]},proxy:!0},{key:"right",fn:function(){return[r("a",{attrs:{disabled:!t.isUndoable,title:"cmd + z"},on:{click:t.undo}},[t._v("undo")]),r("a",{attrs:{disabled:!t.isRedoable,title:"cmd + shift + z"},on:{click:t.redo}},[t._v("redo")]),r("a",{on:{click:t.clear}},[t._v("clear")]),r("a",{on:{click:t.copy}},[t._v("copy")]),r("a",{attrs:{href:t.preview,download:"kare.pkg download "+(new Date).toLocaleString()+".png"}},[t._v("download")]),r("a",{on:{click:t.remove}},[t._v("delete")])]},proxy:!0}])})},tt=[],et=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.drawing=e.$store.state.drawings[e.drawingIdx],e}return Object(p["b"])(e,t),Object.defineProperty(e.prototype,"isUndoable",{get:function(){return this.drawing.canUndo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRedoable",{get:function(){return this.drawing.canRedo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preview",{get:function(){return this.drawing.preview},enumerable:!0,configurable:!0}),e.prototype.created=function(){var t=this;window.addEventListener("keydown",(function(e){return t.keyboardShortcut(e)}))},e.prototype.destroyed=function(){var t=this;window.removeEventListener("keydown",(function(e){return t.keyboardShortcut(e)}))},e.prototype.undo=function(){this.$store.commit("undo",{drawingIdx:this.drawingIdx})},e.prototype.redo=function(){this.$store.commit("redo",{drawingIdx:this.drawingIdx})},e.prototype.clear=function(){this.$store.commit("clear",{drawingIdx:this.drawingIdx})},e.prototype.copy=function(){var t=this;this.$store.commit("copy",{drawingIdx:this.drawingIdx}),this.$router.push("/"),setTimeout((function(){return t.$router.push("/edit/0")}))},e.prototype.remove=function(){window.confirm("This cannot be undone. Are you sure?")&&(this.$store.commit("remove",{drawingIdx:this.drawingIdx}),this.$router.push("/"))},e.prototype.keyboardShortcut=function(t){(t.ctrlKey||t.metaKey)&&90===t.keyCode&&(t.preventDefault(),t.shiftKey?this.redo():this.undo())},Object(p["a"])([Object(I["b"])()],e.prototype,"drawingIdx",void 0),e=Object(p["a"])([Object(I["a"])({name:"EditorHeader",components:{SiteHeader:M}})],e),e}(I["c"]),rt=et,nt=rt,it=Object(a["a"])(nt,Z,tt,!1,null,null,null),ot=it.exports,at=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"editor-wrapper",on:{mousedown:function(e){return e.preventDefault(),t.startStroke(e)},touchstart:function(e){return e.preventDefault(),t.startStroke(e)},mouseover:function(e){return e.preventDefault(),t.continueStroke(e)},touchmove:function(e){return e.preventDefault(),t.continueStroke(e)}}},[r("div",{staticClass:"edit-layer"},t._l(1024,(function(t){return r("div",{key:t,staticClass:"pixel",attrs:{"data-pixel-idx":t-1}})})),0),r("preview",{staticClass:"preview-layer",attrs:{drawingIdx:t.drawingIdx}})],1)},st=[],ct=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pixelMap=e.$store.state.drawings[e.drawingIdx].pixelMap,e.isStroking=!1,e.fill=!1,e}return Object(p["b"])(e,t),e.prototype.created=function(){window.addEventListener("mouseup",this.endStroke),window.addEventListener("touchcancel",this.endStroke),window.addEventListener("touchend",this.endStroke)},e.prototype.destroyed=function(){window.removeEventListener("mouseup",this.endStroke),window.removeEventListener("touchcancel",this.endStroke),window.removeEventListener("touchend",this.endStroke)},e.prototype.startStroke=function(t){var e=this.getPixelIdx(t);e&&(this.isStroking=!0,this.stroke=t,this.fill=!this.pixelMap[e],this.flip(e))},e.prototype.continueStroke=function(t){if(this.isStroking){var e=this.getPixelIdx(t);e&&this.fill!==!!this.pixelMap[e]&&this.flip(e)}},e.prototype.endStroke=function(){this.isStroking=!1},e.prototype.getPixelIdx=function(t){var e=t.target;if("touchmove"===t.type){var r=t.changedTouches[0];e=document.elementFromPoint(r.clientX,r.clientY)}return e.dataset.pixelIdx},e.prototype.flip=function(t){this.$store.commit("flip",{drawingIdx:this.drawingIdx,pixelIdx:t,event:this.stroke})},Object(p["a"])([Object(I["b"])()],e.prototype,"drawingIdx",void 0),e=Object(p["a"])([Object(I["a"])({name:"Editor",components:{Preview:K}})],e),e}(I["c"]),ut=ct,dt=ut,lt=(r("6fc8"),Object(a["a"])(dt,at,st,!1,null,"39deb666",null)),pt=lt.exports,ft={name:"Edit",props:["drawingIdx"],components:{EditorHeader:ot,Preview:K,Editor:pt}},ht=ft,gt=(r("1f8b"),Object(a["a"])(ht,V,W,!1,null,"cd72549c",null)),vt=gt.exports;n["a"].use(d["a"]);var wt=[{path:"/",name:"Home",component:Q},{path:"/edit/:drawingIdx",name:"Edit",component:vt,props:!0},{path:"*",component:Q}],bt=new d["a"]({base:"/kare-pkg/",routes:wt});bt.beforeEach((function(t,e,r){if("Edit"!==t.name)return r();var n=parseInt(t.params.drawingIdx);return m.state.drawings[n]?r():r(e.path)}));var mt=bt,yt=r("9483");r("f5df");Object(yt["a"])("/kare-pkg/service-worker.js"),window.oncontextmenu=function(t){return t.preventDefault(),t.stopPropagation(),!1},m.commit("load"),new n["a"]({router:mt,store:m,render:function(t){return t(u)}}).$mount("#app")},e4aa:function(t,e,r){"use strict";var n=r("1d97"),i=r.n(n);i.a}});
//# sourceMappingURL=app.38a47eae.js.map