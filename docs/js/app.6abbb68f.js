(function(e){function t(t){for(var r,a,c=t[0],d=t[1],u=t[2],l=0,p=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in d)Object.prototype.hasOwnProperty.call(d,r)&&(e[r]=d[r]);s&&s(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var d=n[c];0!==o[d]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/kare-pkg/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var s=d;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0c58":function(e,t,n){},"225f":function(e,t,n){},"3c34":function(e,t,n){"use strict";n("4c35")},"4c35":function(e,t,n){},"5ca3":function(e,t,n){"use strict";n("7cc2")},"602b":function(e,t,n){"use strict";n("77f9")},"77f9":function(e,t,n){},"7cc2":function(e,t,n){},8960:function(e,t,n){"use strict";n("a6b0")},"9afc":function(e,t,n){"use strict";n("225f")},a6b0:function(e,t,n){},bfd7:function(e,t,n){"use strict";n("0c58")},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("f5df1");var r=n("7a23");function o(e,t){var n=Object(r["resolveComponent"])("router-view");return Object(r["openBlock"])(),Object(r["createBlock"])(n,null,{default:Object(r["withCtx"])((function(e){var t=e.Component;return[Object(r["createVNode"])(r["Transition"],{name:"fade",mode:"out-in"},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(t)))]})),_:2},1024)]})),_:1})}n("602b");const i={};i.render=o;var a=i,c=n("6c02"),d=Object(r["withScopeId"])("data-v-0a8fd215");Object(r["pushScopeId"])("data-v-0a8fd215");var u=Object(r["createVNode"])("label",{for:"import"},[Object(r["createVNode"])("a",null,"import")],-1),s={class:"thumbnail-grid"};Object(r["popScopeId"])();var l=d((function(e,t,n,o,i,a){var c=Object(r["resolveComponent"])("app-header"),l=Object(r["resolveComponent"])("drawing-preview"),p=Object(r["resolveComponent"])("router-link"),f=Object(r["resolveComponent"])("draggable");return Object(r["openBlock"])(),Object(r["createBlock"])("div",null,[Object(r["createVNode"])(c,null,{left:d((function(){return[Object(r["createVNode"])("a",{onClick:t[1]||(t[1]=Object(r["withModifiers"])((function(){return e.newDrawing&&e.newDrawing.apply(e,arguments)}),["prevent"]))},"+ NEW")]})),right:d((function(){return[Object(r["createVNode"])("form",null,[u,Object(r["createVNode"])("input",{onChange:t[2]||(t[2]=function(){return e.importDrawings&&e.importDrawings.apply(e,arguments)}),type:"file",accept:".json",multiple:"false",id:"import",hidden:""},null,32)]),Object(r["createVNode"])("a",{href:e.exportUri,disabled:e.drawingsEmpty,download:"kare.pkg-export-".concat((new Date).toLocaleString(),".json")},"export",8,["href","disabled","download"]),Object(r["createVNode"])("a",{onClick:t[3]||(t[3]=function(){return e.deleteAllDrawings&&e.deleteAllDrawings.apply(e,arguments)}),disabled:e.drawingsEmpty},"delete all",8,["disabled"])]})),_:1}),Object(r["createVNode"])("main",s,[Object(r["createVNode"])(f,Object(r["mergeProps"])({modelValue:e.drawings,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.drawings=t})},e.dragOptions,{"item-key":"id"}),{item:d((function(t){var n=t.index;return[Object(r["createVNode"])(p,{class:"thumbnail-wrapper",to:e.routeForEdit(n)},{default:d((function(){return[Object(r["createVNode"])(l,{class:"thumbnail",idx:n},null,8,["idx"])]})),_:2},1032,["to"])]})),_:1},16,["modelValue"])])])})),p=n("5502"),f=n("b76a"),h=n.n(f),v={class:"app-header"},b={class:"left"},w={class:"right"};function g(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])("header",v,[Object(r["createVNode"])("div",b,[Object(r["renderSlot"])(e.$slots,"left")]),Object(r["createVNode"])("div",w,[Object(r["renderSlot"])(e.$slots,"right")])])}n("8960");const m={};m.render=g;var O=m,j=Object(r["withScopeId"])("data-v-4cd58bb7"),k=j((function(e,t,n,o,i,a){return Object(r["openBlock"])(),Object(r["createBlock"])("img",{src:e.preview},null,8,["src"])})),y=(n("a9e3"),Object(r["defineComponent"])({props:{idx:{type:Number,required:!0}},setup:function(e){var t=Object(p["b"])();return{preview:Object(r["computed"])((function(){return t.state.drawings[e.idx].preview}))}}}));n("3c34");y.render=k,y.__scopeId="data-v-4cd58bb7";var x=y,S=Object(r["defineComponent"])({components:{AppHeader:O,Draggable:h.a,DrawingPreview:x},setup:function(){var e=Object(p["b"])(),t=Object(c["c"])(),n=Object(r["ref"])({direction:"horizontal",delay:250,animation:200,easing:"cubic-bezier(0.4, 0, 0.2, 1)",chosenClass:"drag-chosen",ghostClass:"drag-ghost"}),o=Object(r["computed"])({get:function(){return e.state.drawings},set:function(t){e.commit("setDrawings",t)}}),i=Object(r["computed"])((function(){return 0===e.state.drawings.length})),a=Object(r["computed"])((function(){return e.getters.uriForDrawingsExport}));function d(e){return"/edit/".concat(e)}function u(){setTimeout((function(){return e.commit("newDrawing")})),t.push(d(0))}function s(t){var n=t.target;if(n&&n.files&&0!==n.files.length){var r=new FileReader;r.onload=function(t){var n=t.target.result;n&&e.commit("loadFromExport",{export:n})},r.readAsText(n.files[0]),n.parentElement.reset()}}function l(){window.confirm("This cannot be undone. Are you sure?")&&e.commit("deleteAllDrawings")}return{dragOptions:n,drawings:o,drawingsEmpty:i,exportUri:a,routeForEdit:d,newDrawing:u,importDrawings:s,deleteAllDrawings:l}}});n("9afc");S.render=l,S.__scopeId="data-v-0a8fd215";var C=S,D=Object(r["withScopeId"])("data-v-41f97858");Object(r["pushScopeId"])("data-v-41f97858");var N=Object(r["createTextVNode"])("< BACK");Object(r["popScopeId"])();var P=D((function(e,t,n,o,i,a){var c=Object(r["resolveComponent"])("router-link"),d=Object(r["resolveComponent"])("app-header"),u=Object(r["resolveComponent"])("drawing-preview"),s=Object(r["resolveComponent"])("drawing-editor");return Object(r["openBlock"])(),Object(r["createBlock"])("div",null,[Object(r["createVNode"])(d,null,{left:D((function(){return[Object(r["createVNode"])(c,{to:"/"},{default:D((function(){return[N]})),_:1})]})),right:D((function(){return[Object(r["createVNode"])("a",{onClick:t[1]||(t[1]=function(){return e.undo&&e.undo.apply(e,arguments)}),disabled:e.undoDisabled},"undo",8,["disabled"]),Object(r["createVNode"])("a",{onClick:t[2]||(t[2]=function(){return e.redo&&e.redo.apply(e,arguments)}),disabled:e.redoDisabled},"redo",8,["disabled"]),Object(r["createVNode"])("a",{onClick:t[3]||(t[3]=function(){return e.clear&&e.clear.apply(e,arguments)}),disabled:e.clearDisabled},"clear",8,["disabled"]),Object(r["createVNode"])("a",{onClick:t[4]||(t[4]=function(){return e.copyDrawing&&e.copyDrawing.apply(e,arguments)})},"make copy"),Object(r["createVNode"])("a",{href:e.downloadUri,download:"kare.pkg-drawing-".concat((new Date).toLocaleString(),".png")},"download",8,["href","download"]),Object(r["createVNode"])("a",{onClick:t[5]||(t[5]=function(){return e.deleteDrawing&&e.deleteDrawing.apply(e,arguments)})},"delete")]})),_:1}),Object(r["createVNode"])("main",null,[Object(r["createVNode"])(u,{class:"preview",idx:e.drawingIdx},null,8,["idx"]),Object(r["createVNode"])(s,{class:"editor",idx:e.drawingIdx},null,8,["idx"])])])})),V=Object(r["withScopeId"])("data-v-2a9b59b5");Object(r["pushScopeId"])("data-v-2a9b59b5");var I={class:"edit-layer"};Object(r["popScopeId"])();var _=V((function(e,t,n,o,i,a){var c=Object(r["resolveComponent"])("drawing-preview");return Object(r["openBlock"])(),Object(r["createBlock"])("div",{class:"wrapper",onMousedown:t[1]||(t[1]=Object(r["withModifiers"])((function(){return e.startStroke&&e.startStroke.apply(e,arguments)}),["prevent"])),onTouchstart:t[2]||(t[2]=Object(r["withModifiers"])((function(){return e.startStroke&&e.startStroke.apply(e,arguments)}),["prevent"])),onMouseover:t[3]||(t[3]=Object(r["withModifiers"])((function(){return e.continueStroke&&e.continueStroke.apply(e,arguments)}),["prevent"])),onTouchmove:t[4]||(t[4]=Object(r["withModifiers"])((function(){return e.continueStroke&&e.continueStroke.apply(e,arguments)}),["prevent"]))},[Object(r["createVNode"])("table",I,[(Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(32,(function(e){return Object(r["createVNode"])("tr",{key:e},[(Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(32,(function(t){return Object(r["createVNode"])("td",{key:t,"data-pixel":32*(e-1)+(t-1)},null,8,["data-pixel"])})),64))])})),64))]),Object(r["createVNode"])(c,{class:"preview-layer",idx:e.idx},null,8,["idx"])],32)})),E=Object(r["defineComponent"])({components:{DrawingPreview:x},props:{idx:{type:Number,required:!0}},setup:function(e){var t=Object(p["b"])(),n=void 0;function o(r){var o=d(r);null!==o&&(n={userAction:r,willFill:!c(o)},t.commit("flip",{drawing:e.idx,pixel:o,event:r}))}function i(r){if(void 0!==n){var o=d(r);null!==o&&n.willFill!==c(o)&&t.commit("flip",{drawing:e.idx,pixel:o,event:n.userAction})}}function a(){n=void 0}function c(n){return t.state.drawings[e.idx].isFilled(n)}function d(e){var t;if("touchmove"===e.type){var n=e.changedTouches[0];t=document.elementFromPoint(n.clientX,n.clientY)}else t=e.target;var r=t.dataset.pixel;if(void 0===r)return null;var o=parseInt(r);return isNaN(o)?null:o}return Object(r["onMounted"])((function(){window.addEventListener("mouseup",a),window.addEventListener("touchcancel",a),window.addEventListener("touchend",a)})),Object(r["onUnmounted"])((function(){window.removeEventListener("mouseup",a),window.removeEventListener("touchcancel",a),window.removeEventListener("touchend",a)})),{startStroke:o,continueStroke:i}}});n("5ca3");E.render=_,E.__scopeId="data-v-2a9b59b5";var B=E,A=Object(r["defineComponent"])({components:{AppHeader:O,DrawingEditor:B,DrawingPreview:x},props:{idx:{type:String,required:!0}},setup:function(e){Object(r["onMounted"])((function(){return window.addEventListener("keydown",(function(e){return w(e)}))})),Object(r["onUnmounted"])((function(){return window.removeEventListener("keydown",(function(e){return w(e)}))}));var t=Object(p["b"])(),n=Object(c["c"])(),o=parseInt(e.idx),i=t.state.drawings[o],a=Object(r["computed"])((function(){return i.preview})),d=Object(r["computed"])((function(){return!i.canUndo})),u=Object(r["computed"])((function(){return!i.canRedo})),s=Object(r["computed"])((function(){return!i.canClear}));function l(){t.commit("undo",{drawing:o})}function f(){t.commit("redo",{drawing:o})}function h(){t.commit("clear",{drawing:o})}function v(){setTimeout((function(){return t.commit("copyDrawing",{drawing:o})})),n.push("/"),setTimeout((function(){return n.push("/edit/0")}))}function b(){window.confirm("This cannot be undone. Are you sure?")&&(setTimeout((function(){return t.commit("deleteDrawing",{drawing:o})})),n.push("/"))}function w(e){(e.ctrlKey||e.metaKey)&&90===e.keyCode&&(e.shiftKey?f():l(),e.preventDefault())}return{drawingIdx:o,downloadUri:a,undoDisabled:d,redoDisabled:u,clearDisabled:s,undo:l,redo:f,clear:h,copyDrawing:v,deleteDrawing:b}}});n("bfd7");A.render=P,A.__scopeId="data-v-41f97858";var L=A,U=[{path:"/",component:C},{path:"/edit/:idx",component:L,props:!0},{path:"/:pathMatch(.*)*",name:"404",component:C}],F=Object(c["a"])({history:Object(c["b"])("/kare-pkg/"),routes:U}),M=(n("d81d"),n("a434"),n("d3b7"),n("25f0"),n("b85c")),T=n("d4ec"),R=n("bee2"),z=(n("6062"),n("3ca3"),n("ddb0"),n("a630"),n("fb6a"),function(){function e(t){var n,r;Object(T["a"])(this,e),this.id=Math.random(),this._preview="",this.size=null!==(n=null===t||void 0===t?void 0:t.size)&&void 0!==n?n:32,this.pixels=null!==t&&void 0!==t&&t.data?new Set(t.data.pixels):new Set,this.canvas=new J(this.size);var o,i=Object(M["a"])(this.pixels);try{for(i.s();!(o=i.n()).done;){var a=o.value;this.canvas.add(a)}}catch(c){i.e(c)}finally{i.f()}this.history=null!==t&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&r.history?new K({data:{strokes:t.data.history.strokes,currStroke:t.data.history.currStroke}}):new K,this.updatePreview()}return Object(R["a"])(e,[{key:"preview",get:function(){return this._preview}},{key:"canUndo",get:function(){return this.history.canUndo}},{key:"canRedo",get:function(){return this.history.canRedo}},{key:"canClear",get:function(){return this.pixels.size>0}},{key:"isFilled",value:function(e){return this.pixels.has(e)}},{key:"update",value:function(e,t){e<0||e>=this.size*this.size||(this.flip(e),this.history.record(e,t),this.updatePreview())}},{key:"clear",value:function(){var e,t=Object(M["a"])(this.pixels);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.flip(n),this.history.record(n,null)}}catch(r){t.e(r)}finally{t.f()}this.updatePreview()}},{key:"undo",value:function(){var e=this;this.history.undo((function(t){return e.flip(t)})),this.updatePreview()}},{key:"redo",value:function(){var e=this;this.history.redo((function(t){return e.flip(t)})),this.updatePreview()}},{key:"export",value:function(){return{pixels:Array.from(this.pixels),history:this.history.export()}}},{key:"flip",value:function(e){this.pixels.delete(e)?this.canvas.remove(e):(this.pixels.add(e),this.canvas.add(e))}},{key:"updatePreview",value:function(){this._preview=this.canvas.img}}]),e}()),J=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;Object(T["a"])(this,e),this.widthInPixels=t,this.pxPerPixel=n,this.domCanvas=document.createElement("canvas"),this.domContext=this.domCanvas.getContext("2d");var r=this.widthInPixels*this.pxPerPixel;this.domCanvas.height=r,this.domCanvas.width=r,this.domContext.fillStyle="#fff",this.domContext.fillRect(0,0,r,r)}return Object(R["a"])(e,[{key:"img",get:function(){return this.domCanvas.toDataURL("image/png")}},{key:"add",value:function(e){this.paint(e,"#000")}},{key:"remove",value:function(e){this.paint(e,"#fff")}},{key:"paint",value:function(e,t){var n=e%this.widthInPixels,r=Math.floor(e/this.widthInPixels);this.domContext.fillStyle=t,this.domContext.fillRect(n*this.pxPerPixel,r*this.pxPerPixel,this.pxPerPixel,this.pxPerPixel)}}]),e}(),K=function(){function e(t){var n,r,o,i;Object(T["a"])(this,e),this.currUserAction=void 0,this.strokes=null!==(n=null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r.strokes)&&void 0!==n?n:[],this.currStroke=null!==(o=null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.currStroke)&&void 0!==o?o:-1}return Object(R["a"])(e,[{key:"canUndo",get:function(){return this.currStroke>=0}},{key:"canRedo",get:function(){return this.currStroke<this.strokes.length-1}},{key:"undo",value:function(e){if(this.canUndo){var t,n=Object(M["a"])(this.strokes[this.currStroke]);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r)}}catch(o){n.e(o)}finally{n.f()}this.currStroke--}}},{key:"redo",value:function(e){if(this.canRedo){this.currStroke++;var t,n=Object(M["a"])(this.strokes[this.currStroke]);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"record",value:function(e,t){t===this.currUserAction?this.strokes[this.currStroke].push(e):(this.currUserAction=t,this.currStroke++,this.strokes[this.currStroke]=[e]),this.strokes.length>this.currStroke+1&&(this.strokes=this.strokes.slice(0,this.currStroke+1))}},{key:"export",value:function(){return{strokes:this.strokes,currStroke:this.currStroke}}}]),e}(),q=(n("99af"),[205,206,207,208,209,210,237,238,239,240,241,242,269,270,271,272,273,274,301,302,303,304,305,306]),H=[589,590,591,592,593,594,621,622,623,624,625,626,653,654,655,656,657,658,685,686,687,688,689,690],$=[332,363,395,427,459,491,523,556],W=[339,372,404,436,468,500,532,563],X=[397,434],Y=[462,463,464],G=[368,400,432],Q=[437,469],Z={pixels:[].concat(q,H,$,W,X,Y,G,Q)},ee=Object(p["a"])({state:{drawings:[new z({data:Z})]},getters:{uriForDrawingsExport:function(e){return"data:application/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(e.drawings.map((function(e){return e.export()})))),"\n      ")}},mutations:{flip:function(e,t){e.drawings[t.drawing].update(t.pixel,t.event)},undo:function(e,t){e.drawings[t.drawing].undo()},redo:function(e,t){e.drawings[t.drawing].redo()},clear:function(e,t){e.drawings[t.drawing].clear()},copyDrawing:function(e,t){var n=e.drawings[t.drawing].export(),r=new z({data:n});e.drawings.unshift(r)},newDrawing:function(e){e.drawings.unshift(new z)},deleteDrawing:function(e,t){e.drawings.splice(t.drawing,1)},deleteAllDrawings:function(e){e.drawings.splice(0,e.drawings.length)},saveToLocalStorage:function(e){var t=e.drawings.map((function(e){return e.export()}));localStorage.setItem("kare-pkg",JSON.stringify(t))},loadFromLocalStorage:function(e){if(localStorage["kare-pkg"]){var t=JSON.parse(localStorage["kare-pkg"]);e.drawings=t.map((function(e){return new z({data:e})}))}},loadFromExport:function(e,t){for(var n=JSON.parse(t.export.toString()),r=n.length-1;r>=0;r--)try{e.drawings.unshift(new z({data:n[r]}))}catch(o){}},setDrawings:function(e,t){e.drawings=t}}});window.oncontextmenu=function(e){return e.preventDefault()},window.onbeforeunload=function(){return ee.commit("saveToLocalStorage")},ee.commit("loadFromLocalStorage"),Object(r["createApp"])(a).use(ee).use(F).mount("#app")}});
//# sourceMappingURL=app.6abbb68f.js.map