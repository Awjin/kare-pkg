webpackJsonp([1],{"+KC4":function(t,e){},"3GbU":function(t,e){},HpQT:function(t,e){},NHnr:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("7+uW"),i=r("NYxO"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("router-view",{key:Math.random()})],1)},staticRenderFns:[]};var s=r("VU/8")({name:"App"},a,!1,function(t){r("+KC4")},null,null).exports,o=r("/ocq"),d=r("BO1k"),c=r.n(d),l=r("mvHQ"),u=r.n(l),h={name:"Editor",props:["drawingIdx"],data:function(){return{pixels:this.$store.state.drawings[this.drawingIdx].pixels,isDrawing:!1,isFilling:!1}},methods:{trackStart:function(t){var e=t.target.dataset.pixelIdx;void 0!==e&&(this.isDrawing=!0,this.isFilling=!this.pixels[e],this.$store.commit("startAction",{drawingIdx:this.drawingIdx}),this.toggleFill(e))},toggleFill:function(t){this.pixels[t]!=this.isFilling&&this.$store.commit("updateDrawing",{drawingIdx:this.drawingIdx,pixelIdx:t,value:this.isFilling})},trackMove:function(t){if(this.isDrawing){var e=this.getTarget(t);this.toggleFill(e.dataset.pixelIdx)}},getTarget:function(t){if("touchmove"===t.type){var e=t.changedTouches[0];return document.elementFromPoint(e.clientX,e.clientY)}return t.target},trackEnd:function(){this.isDrawing=!1}},created:function(){window.addEventListener("mouseup",this.trackEnd),window.addEventListener("touchcancel",this.trackEnd),window.addEventListener("touchend",this.trackEnd)},destroyed:function(){window.removeEventListener("mouseup",this.trackEnd),window.removeEventListener("touchcancel",this.trackEnd),window.removeEventListener("touchend",this.trackEnd)}},g={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"editor",on:{mousedown:function(e){return e.preventDefault(),t.trackStart(e)},touchstart:function(e){return e.preventDefault(),t.trackStart(e)},mouseover:function(e){return e.preventDefault(),t.trackMove(e)},touchmove:function(e){return e.preventDefault(),t.trackMove(e)}}},[r("div",{staticClass:"edit-area"},t._l(1024,function(e){return r("div",{staticClass:"pixel",class:{filled:t.pixels[e-1]},attrs:{"data-pixel-idx":e-1}})}))])},staticRenderFns:[]};var v=r("VU/8")(h,g,!1,function(t){r("ihBI")},"data-v-5a4925d6",null).exports,w={name:"Preview",props:["drawingIdx","propResolution","propScale"],data:function(){return{canvas:null,resolution:this.propResolution||32,scale:this.propScale||20,pixels:this.$store.state.drawings[this.drawingIdx].pixels}},computed:{canvasSize:function(){return this.resolution*this.scale},imgSrc:function(){return this.drawPixelsToCanvas(),this.updateImgSrc(),this.$store.state.drawings[this.drawingIdx].imgSrc}},methods:{initCanvas:function(){var t=document.createElement("canvas");t.height=this.canvasSize,t.width=this.canvasSize;var e=t.getContext("2d");e.fillStyle="white",e.fillRect(0,0,this.canvasSize,this.canvasSize),e.fillStyle="black",this.canvas=t},drawPixelsToCanvas:function(){var t=this.canvas.getContext("2d");for(var e in this.pixels){t.fillStyle=this.pixels[e]?"black":"white";var r=e%this.resolution,n=Math.floor(e/this.resolution);t.fillRect(r*this.scale,n*this.scale,this.scale,this.scale)}},updateImgSrc:function(){this.$store.commit("updateImgSrc",{drawingIdx:this.drawingIdx,imgSrc:this.canvas.toDataURL("image/png")})}},created:function(){this.initCanvas()},destroyed:function(){this.canvas.remove()}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"preview"},[e("img",{attrs:{src:this.imgSrc}})])},staticRenderFns:[]};var p=r("VU/8")(w,f,!1,function(t){r("HpQT")},"data-v-37070098",null).exports,m={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"site-header"},[e("router-link",{attrs:{to:"/",id:"home",title:"Home (cmd + /)"}},[e("span",{on:{click:this.blurParent}},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}}),this._v(" "),e("path",{attrs:{d:"M0 0h24v24H0z",fill:"none"}})]),this._v("\n      kare.pkg\n    ")])]),this._v(" "),e("div",{staticClass:"slotted"},[this._t("default")],2)],1)},staticRenderFns:[]};var x=r("VU/8")({name:"SiteHeader",methods:{blurParent:function(t){t.target.parentElement.blur()}}},m,!1,function(t){r("rA1U")},"data-v-23519db9",null).exports,I={name:"DrawingBoard",components:{Editor:v,Preview:p,SiteHeader:x},props:["drawingIdx"],computed:{isNotUndoable:function(){return this.$store.state.drawings[this.drawingIdx].history.currIdx<0},isNotRedoable:function(){var t=this.$store.state.drawings[this.drawingIdx].history;return t.currIdx>=t.actions.length-1},isNotClearable:function(){var t=this.$store.state.drawings[this.drawingIdx].pixels;for(var e in t)if(t[e])return!1;return!0},imgSrc:function(){return this.$store.state.drawings[this.drawingIdx].imgSrc}},methods:{clearDrawing:function(t){t.target.blur(),this.isNotClearable||this.$store.commit("clearDrawing",{drawingIdx:this.drawingIdx})},undoDrawing:function(t){t.target.blur(),this.$store.commit("undoDrawing",{drawingIdx:this.drawingIdx})},redoDrawing:function(t){t.target.blur(),this.$store.commit("redoDrawing",{drawingIdx:this.drawingIdx})},saveDrawing:function(t){t.target.blur()},deleteDrawing:function(t){t.target.blur(),window.confirm("Are you sure? This can't be undone!")&&(this.$store.commit("deleteDrawing",{drawingIdx:this.drawingIdx}),this.$router.push("/"))},keyboardShortcut:function(){var t=this;return function(e){if(e.ctrlKey||e.metaKey)if(e.shiftKey)90===e.keyCode&&(e.preventDefault(),t.redoDrawing(e));else switch(e.keyCode){case 82:break;case 191:e.preventDefault(),t.$router.push("/");break;case 90:e.preventDefault(),t.undoDrawing(e);break;case 88:e.preventDefault(),t.clearDrawing(e);break;case 83:e.preventDefault(),t.saveDrawing(e);break;case 8:e.preventDefault(),t.deleteDrawing(e)}}}},created:function(){window.addEventListener("keydown",this.keyboardShortcut())},destroyed:function(){window.removeEventListener("keydown",this.keyboardShortcut())}},k={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"drawingBoard"},[r("site-header",[r("div",[r("a",{attrs:{disabled:t.isNotUndoable,title:"Undo stroke (cmd + z)"},on:{click:t.undoDrawing}},[t._v("\n        undo\n      ")]),t._v(" "),r("a",{attrs:{disabled:t.isNotRedoable,title:"Redo stroke (cmd + shift + z)"},on:{click:t.redoDrawing}},[t._v("\n        redo\n      ")]),t._v(" "),r("a",{attrs:{title:"Clear pixels (cmd + x)"},on:{click:t.clearDrawing}},[t._v("\n        clear\n      ")]),t._v(" "),r("a",{attrs:{title:"Download png (cmd + s)",href:t.imgSrc,download:"kare-pkg-"+Date.now()+".png"},on:{click:t.saveDrawing}},[t._v("\n        save\n      ")]),t._v(" "),r("a",{attrs:{title:"Delete drawing (cmd + delete)"},on:{click:t.deleteDrawing}},[t._v("\n        delete\n      ")])])]),t._v(" "),r("main",[r("preview",{attrs:{drawingIdx:t.drawingIdx}}),t._v(" "),r("editor",{attrs:{drawingIdx:t.drawingIdx}})],1)],1)},staticRenderFns:[]};var D=r("VU/8")(I,k,!1,function(t){r("kVJ7")},"data-v-58a9866c",null).exports,b={name:"Home",components:{DrawingBoard:D,Preview:p,SiteHeader:x},data:function(){return{drawings:this.$store.state.drawings}},computed:{isNotExportable:function(){return 0===this.$store.state.drawings.length},exportSrc:function(){var t=this.$store.state.drawings,e=[],r=!0,n=!1,i=void 0;try{for(var a,s=c()(t);!(r=(a=s.next()).done);r=!0){var o=a.value;e.push(o.pixels)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var d=u()(e);return"data:application/json;charset=utf-8,"+encodeURIComponent(d)}},methods:{getRoute:function(t){return"/edit/"+t},newDrawing:function(t){t.target.blur(),this.$store.commit("newDrawing"),this.$router.push("/edit/0")},importFile:function(t){var e=this,r=t.target;if(0!==r.files.length){var n=new FileReader;n.onload=function(t){var r=t.target;e.$store.commit("importDrawings",{importedPixels:JSON.parse(r.result)})},n.readAsText(r.files[0]),r.parentElement.reset()}}}},S={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"home"},[r("site-header",[r("div",[r("a",{attrs:{title:"Export backup (cmd + s)",href:t.exportSrc,download:"kare-pkg-backup-"+Date.now()+".json",disabled:t.isNotExportable}},[t._v("\n        export\n      ")]),t._v(" "),r("form",[r("label",{attrs:{for:"file"}},[r("a",[t._v("import")])]),t._v(" "),r("input",{attrs:{accept:".json",hidden:"",id:"file",multiple:"false",title:"Import backup (cmd + o)",type:"file"},on:{change:t.importFile}})])])]),t._v(" "),r("div",{staticClass:"gallery"},[r("button",{staticClass:"thumbnail",attrs:{id:"newDrawing"},on:{click:function(e){return e.preventDefault(),t.newDrawing(e)}}},[t._v("\n      +\n    ")]),t._v(" "),t._l(t.drawings,function(e,n){return r("router-link",{key:Math.random(),staticClass:"thumbnail",attrs:{to:t.getRoute(n)}},[r("div",{staticClass:"control-shade"}),t._v(" "),r("preview",{key:Math.random(),attrs:{drawingIdx:n}})],1)})],2)],1)},staticRenderFns:[]};var y=r("VU/8")(b,S,!1,function(t){r("3GbU")},"data-v-26a53f66",null).exports;n.a.use(o.a);var _=new o.a({routes:[{path:"/",name:"Home",component:y},{path:"/edit/:drawingIdx",name:"Edit",component:D,props:!0},{path:"*",component:y}]}),E=r("fZjL"),$=r.n(E);n.a.use(i.a);var C=new i.a.Store({state:{drawings:[{pixels:{205:!0,206:!0,207:!0,208:!0,209:!0,210:!0,237:!0,238:!0,239:!0,240:!0,241:!0,242:!0,269:!0,270:!0,271:!0,272:!0,273:!0,274:!0,301:!0,302:!0,303:!0,304:!0,305:!0,306:!0,589:!0,590:!0,591:!0,592:!0,593:!0,594:!0,621:!0,622:!0,623:!0,624:!0,625:!0,626:!0,653:!0,654:!0,655:!0,656:!0,657:!0,658:!0,685:!0,686:!0,687:!0,688:!0,689:!0,690:!0,332:!0,363:!0,395:!0,427:!0,459:!0,491:!0,523:!0,556:!0,339:!0,372:!0,404:!0,436:!0,468:!0,500:!0,532:!0,563:!0,437:!0,469:!0,462:!0,463:!0,464:!0,368:!0,400:!0,432:!0},imgSrc:"",history:{currIdx:-1,actions:[]}}]},mutations:{newDrawing:function(t){F(t,{})},importDrawings:function(t,e){for(var r=e.importedPixels.filter(function(t){return function(t,e){var r=$()(e);return 0!==r.length&&(r.forEach(function(t){if(isNaN(t))return!1;var r=parseFloat(t);return r===parseInt(r)&&!(r<0||r>1023)&&"boolean"==typeof e[t]&&void 0}),!0)}(0,t)}),n=r.length-1;n>=0;n--)F(t,r[n])},startAction:function(t,e){N(t,e.drawingIdx)},updateDrawing:function(t,e){var r=e.drawingIdx,n=e.pixelIdx;U(t,r,n,e.value),L(t,r,n),R(t)},undoDrawing:function(t,e){var r=e.drawingIdx,n=t.drawings[r].history;n.currIdx<0||(H(t,r),n.currIdx--,R(t))},redoDrawing:function(t,e){var r=e.drawingIdx,n=t.drawings[r].history;n.currIdx>=n.actions.length-1||(n.currIdx++,H(t,r),R(t))},clearDrawing:function(t,e){var r=e.drawingIdx;N(t,r);var n=t.drawings[r].pixels;for(var i in n)n[i]&&(U(t,r,i,!1),L(t,r,i));R(t)},deleteDrawing:function(t,e){var r=e.drawingIdx;this.state.drawings.splice(r,1),R(t)},updateImgSrc:function(t,e){var r=e.drawingIdx,n=e.imgSrc;t.drawings[r].imgSrc=n},loadFromLocalStorage:function(t){if(localStorage["kare-pkg"]){var e=JSON.parse(localStorage["kare-pkg"]).drawings;n.a.set(t,"drawings",e)}else localStorage.setItem("kare-pkg",u()(t))}}});function F(t,e){t.drawings.unshift({pixels:e,imgSrc:"",history:{currIdx:-1,actions:[]}}),R(t)}function R(t){localStorage.setItem("kare-pkg",u()(t))}function N(t,e){var r=t.drawings[e].history,n=r.actions.length-1-r.currIdx;n>0&&r.actions.splice(r.currIdx+1,n),r.actions.push([]),r.currIdx++}function U(t,e,r,i){var a=t.drawings[e].pixels;n.a.set(a,r,i)}function L(t,e,r){var n=t.drawings[e];n.history.actions[n.history.currIdx].push(r)}function H(t,e){var r=t.drawings[e],n=r.history.actions[r.history.currIdx],i=r.pixels[n[0]];n.forEach(function(r){U(t,e,r,!i)})}r("uMhA");n.a.config.productionTip=!1,n.a.use(i.a),_.beforeEach(function(t,e,r){if("Edit"===t.name){var n=t.params.drawingIdx;if(!C.state.drawings[n])return void r(e.path)}r()}),C.commit("loadFromLocalStorage"),new n.a({el:"#app",components:{App:s},template:"<App/>",router:_,store:C})},ihBI:function(t,e){},kVJ7:function(t,e){},rA1U:function(t,e){},uMhA:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.26800d250ac27ca4f16b.js.map